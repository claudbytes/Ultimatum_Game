---
title: "Maxi Analysis"
author: "Claudia Falsetti"
date: "7 February 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. 

In the first code block are stored all the libraries that will be needed. 

```{r libraries}
setwd("~/Maxi/Maxi Trial") 
library(tidyverse)
```

Now the .csv files are loaded in as a list and imported within the same dataframe named data. 

```{r dataframe, warning=FALSE, error=FALSE}
results = list.files(pattern = ".csv")
data = lapply(results, read.csv, header = FALSE, stringsAsFactors = FALSE)
data_frame <- do.call("rbind", data)

```

Data preprocessing: eliminate unneeded columnes and rows, prepare the data for statistical analysis 
```{r preprocessing }

data_frame <- data_frame[-1: -2, ] %>%  ## remove first 2 rows (completion code) 
  select(V2, V27, V28, V29, V33, V34)  ## and select relevant columns

colnames(data_frame) <- data_frame[1,]   ####### set the first row to be the header of the data frame 
final_data <- data_frame[-1, ] 

final_data <- filter(final_data, trialNo != "na", trialNo != "", trialNo != "trialNo") 

final_data <- final_data %>%     #### add a column for sujb_id, 275 represents nÂ° of trials per participant
  mutate("subj_id" = rep(1:23,each=275))   ### change 5 with actual number of participants

final_data <- final_data %>% 
  filter(trialNo != "na", trialNo != " ", trialNo != "trialNo") %>%
    mutate("subj_id" = rep(1:23, each = 275))

```

Descriptives. 
Before proceding to the analysis, the dataset is explored. 
This includes measures of means, standard deviations and plots. 

```{r Descriptive, warning=FALSE}

ultimatum <- dat3 %>%   ## create a dataframe with only UltimatumGame results 
  group_by(subj_id) %>%          ########## recode response as acceptance -> accepted=1, rejected = 0
  filter(game == "ultimatum") %>% 
  mutate(acceptance = if_else(response == 1, 0L, 1L)) %>% 
  mutate(RT_S = RT / 1000)

cell_means<- with(ultimatum, aggregate(x = list(mean_acceptance = acceptance),  by= list(stim_type = stim_type, offer = offer), FUN = mean))

cell_means2 <- cell_means %>% 
  mutate(SD = sqrt( cell_means$mean_acceptance * (1 -       cell_means$mean_acceptance)))

plot(cell_means2)

```
